<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talent Compass</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel for JSX Transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #a8a8a8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #888; }
        /* Simple fadeIn animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
    <!-- ES Module Shims for handling browser imports -->
    <script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js"></script>
    <!-- Import Map for dependencies -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "lucide-react": "https://esm.sh/lucide-react@0.378.0",
        "recharts": "https://esm.sh/recharts@2.12.7"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <!-- Main React Application Script -->
    <script type="text/babel" data-type="module">
        // --- DEPENDENCY IMPORTS ---
        import React, { useState, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line, AreaChart, Area } from 'recharts';
        import { Users, Briefcase, Target, Star, TrendingUp, BookOpen, Settings, Bell, ChevronDown, Search, Filter, Mail, Phone, MapPin, ChevronsRight, FileText, BarChart2, Plus, CheckCircle, Clock, Sparkles, X, AlertTriangle, MessageSquare, Award, Calendar, Share2, Eye, Building, Globe, RotateCcw, User, GraduationCap, Info, MessageCircle, GitBranch, ArrowUpCircle, Zap, Shield, ShieldCheck, UserX, UserPlus, Grid, List, Edit, Check, Tag, ExternalLink, UserMinus, Gift } from 'lucide-react';

        // --- MASTER DATA ---
        const masterCompetencies = [
            'Strategic Thinking', 'Collaboration', 'Urban Resilience Planning', 'Risk Assessment', 'Policy Formulation',
            'Engaging the Regulated', 'Regulatory Quality & Standards', 'Regulatory Operations Management & Delivery', 
            'Compliance Strategy & Monitoring Design', 'Evidence Gathering', 'Clear & Concise Writing', 'Interview Techniques',
            'Decisiveness', 'Resilience', 'Regulatory Enforcement', 'Investigation', 'Operational Planning', 'Team Leadership',
            'Problem Solving', 'Interpersonal Skills', 'Case Adjudication', 'Legal Interpretation', 'Client Communication',
            'Attention to Detail', 'Integrity', 'Forensic Investigation', 'Evidence Management', 'Mentoring', 'Digital Transformation'
        ];


        // --- FILTER DATA STRUCTURE ---
        const filterOptions = {
            department: ['ACE Group', 'FMMD', 'OSHD'],
            organisationalUnit: {
                'ACE Group': ['Case Management Branch', 'Ops Monitoring and development_scheme', 'Healthcare Resilience', 'Housing Resilience'],
                'FMMD': ['Enforcement Planning Team', 'Inspection Team', 'Investigation Team', 'Licensing Team'],
                'OSHD': ['Accident Investigation (OSHI)', 'Investigation & Enforcement', 'Major Hazards Department', 'Work Injury Compensation']
            },
            domain: ['Enforcement', 'Planning & Policy', 'Service Delivery & Case Management']
        };


        // --- MOCK DATA (ENRICHED WITH PERSONNEL FILE INFO & ASPIRATIONAL FEEDBACK) ---
        const mockTalent = [
            {
                id: 1,
                name: 'Li Wei Tan',
                age: 32,
                employeeId: 'EMP-01234',
                email: 'liwei.tan@gov.sg',
                phone: '+65 9123 4567',
                education: 'M.Sc. Computer Science, National University of Singapore',
                certifications: ['Certified Scrum Master (CSM)', 'AWS Certified Solutions Architect'],
                title: 'Senior Investigation Officer',
                department: 'FMMD',
                organisationalUnit: 'Investigation Team',
                domain: 'Enforcement',
                performance: 4.5,
                potential: 5,
                readiness: 'Ready Now',
                development_scheme: 'MLDP',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=LW',
                scholar: true,
                tags: ['High-Potential', 'Scholar', 'Mobility-Ready'],
                joinDate: '2021-07-15',
                employmentType: 'Full-Time Permanent',
                manager: 'Grace Wong',
                jobGrade: 'MX11',
                hrKakiPlanUrl: '#',
                status: 'Active',
                resignationDate: null,
                emergencyContact: { name: 'Mei Lin Tan', relation: 'Spouse', phone: '+65 9876 5432' },
                performanceHistory: [
                    { year: 2023, score: 4.1 },
                    { year: 2024, score: 4.2 },
                    { year: 2025, score: 4.5 },
                ],
                competencies: {
                    foundational: ['Engaging the Regulated', 'Regulatory Quality & Standards', 'Regulatory Operations Management & Delivery', 'Compliance Strategy & Monitoring Design'],
                    functional: ['Evidence Gathering', 'Clear & Concise Writing', 'Interview Techniques', 'Digital Transformation']
                },
                careerHistory: [
                    { role: 'Senior Policy Manager', department: 'ACE Group', startDate: '2023-06-01', endDate: 'Present' },
                    { role: 'Policy Manager', department: 'ACE Group', startDate: '2021-07-15', endDate: '2023-05-30' },
                ],
                careerJourneyEvents: [
                    { date: '2025-01-15', title: 'Data Analytics Taskforce', type: 'Gig Work', description: 'Led a 3-month project to analyze citizen feedback data using Python.' },
                    { date: '2024-09-10', title: 'Future Leaders Programme', type: 'Milestone', description: 'Completed the 6-month intensive leadership development programme.' },
                    { date: '2024-02-01', title: 'AI in Governance Summit', type: 'Gig Work', description: 'Organizing committee member for a cross-agency summit.' },
                    { date: '2023-11-01', title: 'Project Nightingale Lead', type: 'Deployment', description: 'Led the cross-functional team for a major policy implementation.' },
                    { date: '2023-06-01', title: 'Promoted to Senior Policy Manager', type: 'Promotion', description: 'Advanced to lead a team of 5 policy managers.' },
                    { date: '2022-08-20', title: 'National Policy Review Taskforce', type: 'Deployment', description: 'Served as a core team member for the "Forward Singapore 2025" policy review.' },
                    { date: '2022-01-10', title: 'Data Storytelling Workshop', type: 'Milestone', description: 'Completed a 3-day workshop on effective data visualization and communication.' },
                    { date: '2021-07-15', title: 'Joined as Policy Manager', type: 'Promotion', description: 'Hired into the ACE Group.' },
                    { date: '2020-03-01', title: 'Secondment to Ministry of Finance', type: 'Secondment', description: '6-month secondment focusing on budget planning for digital projects.' }
                ],
                feedback: [
                    { date: '2024-10-02', formName: 'FLP Post-Program Survey', sentiment: 'Positive', sentimentScore: 0.9, summary: 'Eager to apply new leadership skills. Her goal is to lead a digital transformation project.' },
                    { date: '2023-12-20', formName: '360 Feedback', sentiment: 'Positive', sentimentScore: 0.8, summary: 'Excellent cross-functional collaboration and communication skills. Wants to get involved in policy-making.' },
                ],
                careerAspirations: 'Aspires to a Deputy Director role, focusing on digital transformation in public service.',
                remarks: [
                    { date: '2025-08-10', author: 'Sarah Ho', text: 'Li Wei shows exceptional leadership potential. Recommended for the upcoming cross-agency taskforce on AI governance to broaden her strategic exposure.' },
                    { date: '2025-01-20', author: 'Michael Lim', text: 'Performance review follow-up: Consistently exceeds expectations in complex investigations. Development plan should focus on policy-making skills for her next role.' }
                ]
            },
            {
                id: 2,
                name: 'Rajesh Kumar',
                age: 38,
                employeeId: 'EMP-00987',
                email: 'rajesh.kumar@gov.sg',
                phone: '+65 9876 5432',
                education: 'B.Eng. Mechanical Engineering, Nanyang Technological University',
                certifications: ['Project Management Professional (PMP)'],
                title: 'Lead Enforcement Officer',
                department: 'FMMD',
                organisationalUnit: 'Enforcement Planning Team',
                domain: 'Enforcement',
                performance: 4.8,
                potential: 4.2,
                readiness: 'Developing (1-2 Yrs)',
                development_scheme: 'PSLP',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=RK',
                scholar: false,
                tags: ['Top Performer', 'Technical Expert'],
                joinDate: '2022-02-01',
                employmentType: 'Full-Time Permanent',
                manager: 'Michael Lim',
                jobGrade: 'MX11A',
                hrKakiPlanUrl: '#',
                status: 'Active',
                resignationDate: null,
                emergencyContact: { name: 'Priya Kumar', relation: 'Spouse', phone: '+65 9111 2222' },
                performanceHistory: [
                    { year: 2023, score: 4.6 },
                    { year: 2024, score: 4.7 },
                    { year: 2025, score: 4.8 },
                ],
                competencies: {
                    foundational: ['Decisiveness', 'Resilience'],
                    functional: ['Regulatory Enforcement', 'Investigation', 'Operational Planning', 'Team Leadership']
                },
                careerHistory: [
                    { role: 'Lead Enforcement Officer', department: 'FMMD', startDate: '2024-09-01', endDate: 'Present' },
                    { role: 'Senior Enforcement Officer', department: 'FMMD', startDate: '2022-02-01', endDate: '2024-08-30' },
                ],
                careerJourneyEvents: [
                    { date: '2025-03-01', title: 'Cross-Agency Digitalization Taskforce', type: 'Gig Work', description: 'Represents FMMD in a 6-month taskforce to streamline enforcement reporting systems.' },
                    { date: '2024-09-01', title: 'Promoted to Lead Enforcement Officer', type: 'Promotion', description: 'Took charge of the Enforcement Planning Team.' },
                    { date: '2024-04-10', title: 'Advanced Negotiation Workshop', type: 'Milestone', description: 'Attended a specialized workshop for senior enforcement personnel.'},
                    { date: '2023-05-20', title: 'Crisis Management Training', type: 'Milestone', description: 'Certified in advanced crisis negotiation and management.' },
                    { date: '2022-02-01', title: 'Joined as Senior Enforcement Officer', type: 'Promotion', description: 'Began career in FMMD.' },
                ],
                feedback: [
                    { date: '2024-06-15', formName: 'Annual Performance Review', sentiment: 'Positive', sentimentScore: 0.9, summary: 'Excellent leadership. Expressed aspiration to manage a larger team or department.' },
                ],
                careerAspirations: 'Wants to transition into an operational leadership role as Head of a department.',
                remarks: []
            },
            {
                id: 3,
                name: 'Siti Binte Ahmad',
                age: 28,
                employeeId: 'EMP-02589',
                email: 'siti.ahmad@gov.sg',
                phone: '+65 9234 5678',
                education: 'B.A. Public Policy, Singapore Management University',
                certifications: ['Certified Associate in Project Management (CAPM)'],
                title: 'WIC Adjudicator',
                department: 'OSHD',
                organisationalUnit: 'Work Injury Compensation',
                domain: 'Service Delivery & Case Management',
                performance: 4.2,
                potential: 4.5,
                readiness: 'Developing (1-2 Yrs)',
                development_scheme: 'MLDP',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=SA',
                scholar: true,
                tags: ['High-Potential', 'Scholar'],
                joinDate: '2022-08-01',
                employmentType: 'Full-Time Permanent',
                manager: 'Faridah Yusoff',
                jobGrade: 'MX12',
                hrKakiPlanUrl: '#',
                status: 'Active',
                resignationDate: null,
                emergencyContact: { name: 'Ahmad bin Saleh', relation: 'Father', phone: '+65 9333 4444' },
                performanceHistory: [
                    { year: 2024, score: 3.9 },
                    { year: 2025, score: 4.2 },
                ],
                competencies: {
                    foundational: ['Problem Solving', 'Interpersonal Skills'],
                    functional: ['Case Adjudication', 'Legal Interpretation', 'Client Communication']
                },
                careerHistory: [
                    { role: 'WIC Adjudicator', department: 'OSHD', startDate: '2022-08-01', endDate: 'Present' },
                ],
                careerJourneyEvents: [
                    { date: '2024-11-15', title: 'Public Sector Transformation Conference', type: 'Gig Work', description: 'Selected to present a case study on improving adjudication processes.'},
                    { date: '2023-03-15', title: 'Mediation Skills Workshop', type: 'Milestone', description: 'Completed a workshop on advanced conflict resolution.' },
                    { date: '2022-08-01', title: 'Joined as WIC Adjudicator', type: 'Promotion', description: 'Joined OSHD after graduation.' },
                ],
                feedback: [
                    { date: '2024-08-20', formName: 'Mid-Year Review', sentiment: 'Positive', sentimentScore: 0.85, summary: 'Great analytical skill. Aims to deepen her expertise in policy-making.' },
                ],
                careerAspirations: 'Aims to deepen expertise in compensation law and policy-making.',
                remarks: []
            },
            {
                id: 4,
                name: 'Chen Yi Jie',
                age: 45,
                employeeId: 'EMP-00456',
                email: 'yijie.chen@gov.sg',
                phone: '+65 9345 6789',
                education: 'Diploma in Criminology, Temasek Polytechnic',
                certifications: ['Certified Fraud Examiner (CFE)'],
                title: 'Senior Investigation Officer',
                department: 'FMMD',
                organisationalUnit: 'Investigation Team',
                domain: 'Enforcement',
                performance: 4.9,
                potential: 3.5,
                readiness: 'Ready Now',
                development_scheme: 'MLDP',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=CY',
                scholar: false,
                tags: ['Veteran', 'Subject Matter Expert'],
                joinDate: '2010-10-15',
                employmentType: 'Full-Time Permanent',
                manager: 'Michael Lim',
                jobGrade: 'MX10',
                hrKakiPlanUrl: '#',
                status: 'Active',
                resignationDate: null,
                emergencyContact: { name: 'Shu Fen Lee', relation: 'Spouse', phone: '+65 9555 6666' },
                performanceHistory: [
                    { year: 2023, score: 4.8 },
                    { year: 2024, score: 4.8 },
                    { year: 2025, score: 4.9 },
                ],
                competencies: {
                    foundational: ['Attention to Detail', 'Integrity'],
                    functional: ['Forensic Investigation', 'Interviewing Techniques', 'Evidence Management', 'Mentoring']
                },
                careerHistory: [
                    { role: 'Senior Investigation Officer', department: 'FMMD', startDate: '2018-01-01', endDate: 'Present' },
                    { role: 'Investigation Officer', department: 'FMMD', startDate: '2010-05-15', endDate: '2017-12-31' },
                ],
                careerJourneyEvents: [
                    { date: '2024-07-01', title: 'Mentorship Programme Lead', type: 'Deployment', description: 'Designed and implemented the new FMMD mentorship program for junior officers.'},
                    { date: '2022-10-10', title: 'Project Griffin (Joint-Ops)', type: 'Deployment', description: 'Led the FMMD contingent in a multi-agency enforcement operation.' },
                    { date: '2020-05-01', title: 'Digital Forensics Certification', type: 'Milestone', description: 'Achieved certification in advanced digital forensics techniques.'},
                    { date: '2018-01-01', title: 'Promoted to Senior IO', type: 'Promotion', description: 'Promoted to senior investigation officer role.' },
                ],
                feedback: [
                    { date: '2025-01-10', formName: 'Project Griffin AAR', sentiment: 'Positive', sentimentScore: 0.95, summary: 'Invaluable leadership. Expressed a strong desire to focus on training and mentoring new officers.' },
                ],
                careerAspirations: 'Wishes to mentor the next generation of investigators and contribute to training development.',
                remarks: []
            },
            {
                id: 5,
                name: 'Nurul Huda',
                age: 35,
                employeeId: 'EMP-01888',
                email: 'nurul.huda@gov.sg',
                phone: '+65 9456 7890',
                education: 'B.Sc. in Urban Planning, National University of Singapore',
                certifications: ['Business Continuity Certified Planner (BCCP)'],
                title: 'Resilience Planner',
                department: 'ACE Group',
                organisationalUnit: 'Housing Resilience',
                domain: 'Planning & Policy',
                performance: 3.8,
                potential: 4.2,
                readiness: 'Future Potential (3+ Yrs)',
                development_scheme: 'PSLP',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=NH',
                scholar: false,
                tags: ['Strategic Thinker'],
                joinDate: '2019-11-01',
                employmentType: 'Full-Time Permanent',
                manager: 'Grace Wong',
                jobGrade: 'MX11',
                hrKakiPlanUrl: '#',
                status: 'Active',
                resignationDate: null,
                emergencyContact: { name: 'Ismail bin Abdullah', relation: 'Husband', phone: '+65 9777 8888' },
                performanceHistory: [
                    { year: 2023, score: 4.0 },
                    { year: 2024, score: 4.1 },
                    { year: 2025, score: 4.3 },
                ],
                competencies: {
                    foundational: ['Strategic Thinking', 'Collaboration'],
                    functional: ['Urban Resilience Planning', 'Risk Assessment', 'Policy Formulation']
                },
                careerHistory: [
                    { role: 'Resilience Planner', department: 'ACE Group', startDate: '2019-03-01', endDate: 'Present' },
                ],
                careerJourneyEvents: [
                    { date: '2024-05-15', title: 'National Resilience Strategy Working Group', type: 'Deployment', description: 'Key planner in the development of the 2030 National Resilience Framework.'},
                    { date: '2023-08-01', title: 'National Day Parade Contingent Planner', type: 'Secondment', description: '6-month secondment to the NDP 2024 executive committee for logistics planning.' },
                    { date: '2022-04-10', title: 'International Urban Planning Summit', type: 'Gig Work', description: 'Co-authored and presented a paper on sustainable urban development.'},
                    { date: '2021-11-05', title: 'Advanced Risk Management Course', type: 'Milestone', description: 'Completed a specialized course on national-level risk assessment.' },
                ],
                feedback: [
                    { date: '2024-02-15', formName: 'NDP ExCo Feedback', sentiment: 'Positive', sentimentScore: 0.9, summary: 'A meticulous planner. Her goal is to take on a role involving long-term strategic planning.' },
                ],
                careerAspirations: 'Wants to lead a team focused on long-term national resilience strategies.',
                remarks: []
            },
            {
                id: 6,
                name: 'David Chen',
                age: 41,
                employeeId: 'EMP-00777',
                email: 'david.chen@gov.sg',
                phone: '+65 9111 2222',
                education: 'B.Sc. Information Systems, SMU',
                title: 'Policy Manager',
                department: 'ACE Group',
                organisationalUnit: 'Healthcare Resilience',
                domain: 'Planning & Policy',
                performance: 4.1,
                potential: 3.8,
                readiness: 'Future Potential (3+ Yrs)',
                development_scheme: 'Not Enrolled',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=DC',
                joinDate: '2018-05-20',
                status: 'Resigned',
                resignationDate: '2025-03-15',
                remarks: [],
                competencies: { foundational: [], functional: [] },
            },
            {
                id: 7,
                name: 'Aisha Patel',
                age: 33,
                employeeId: 'EMP-00888',
                email: 'aisha.patel@gov.sg',
                phone: '+65 9222 3333',
                education: 'B.A. Sociology, NUS',
                title: 'Inspection Team Lead',
                department: 'FMMD',
                organisationalUnit: 'Inspection Team',
                domain: 'Enforcement',
                performance: 4.4,
                potential: 4.6,
                readiness: 'Developing (1-2 Yrs)',
                development_scheme: 'MLDP',
                headshot: 'https://placehold.co/100x100/E2E8F0/4A5568?text=AP',
                joinDate: '2020-02-10',
                status: 'Resigned',
                resignationDate: '2024-11-20',
                remarks: [],
                competencies: { foundational: [], functional: [] },
            }
        ];

        const keyRolesData = [
            { 
                id: 1, 
                title: 'Director, FMMD', 
                incumbent: 'Michael Lim', 
                candidates: [2, 1, 4],
                competencies: ['Regulatory Enforcement', 'Investigation', 'Team Leadership', 'Strategic Thinking', 'Digital Transformation']
            },
            { 
                id: 2, 
                title: 'Director, ACE Group', 
                incumbent: 'Grace Wong', 
                candidates: [5, 1],
                competencies: ['Policy Formulation', 'Risk Assessment', 'Collaboration', 'Strategic Thinking']
            },
            { 
                id: 3, 
                title: 'Head, OSHD', 
                incumbent: 'Faridah Yusoff', 
                candidates: [3],
                competencies: ['Legal Interpretation', 'Case Adjudication', 'Client Communication', 'Mentoring']
            },
        ];

        const COLORS = {
            'Ready Now': '#10B981',
            'Developing (1-2 Yrs)': '#3B82F6',
            'Future Potential (3+ Yrs)': '#F59E0B'
        };

        const RADIAN = Math.PI / 180;
        const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent, index, name, value }) => {
             if (percent < 0.05) return null; // Don't render label if section is too small
            const radius = innerRadius + (outerRadius - innerRadius) * 0.6;
            const x = cx + radius * Math.cos(-midAngle * RADIAN);
            const y = cy + radius * Math.sin(-midAngle * RADIAN);

            return (
                <text x={x} y={y} fill="white" textAnchor="middle" dominantBaseline="central" className="font-bold text-sm">
                    {`${value}`}
                </text>
            );
        };
        
        // --- HELPER FUNCTIONS ---
        const calculateTenure = (joinDate, endDate = new Date('2025-09-20T20:13:00+08:00')) => {
            const start = new Date(joinDate);
            let years = endDate.getFullYear() - start.getFullYear();
            let months = endDate.getMonth() - start.getMonth();
            if (endDate.getDate() < start.getDate()) {
                months--;
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            return { years, months };
        };


        // --- REUSABLE COMPONENTS ---
        const Sidebar = ({ currentPage, setCurrentPage }) => {
            const navItems = [
                { name: 'Dashboard', icon: <BarChart2 size={20} /> },
                { name: 'Talent Directory', icon: <Users size={20} /> },
                { name: 'Succession Planning', icon: <ChevronsRight size={20} /> },
            ];
            return (
                <aside className="w-64 bg-gray-800 text-gray-200 flex flex-col min-h-screen fixed">
                    <div className="p-6 flex items-center space-x-3">
                        <div className="bg-blue-500 p-2 rounded-lg"><Star size={24} className="text-white" /></div>
                        <h1 className="text-xl font-bold text-white">Talent Compass</h1>
                    </div>
                    <nav className="flex-1 px-4 mt-6">
                        {navItems.map(item => (
                            <a key={item.name} href="#" onClick={(e) => { e.preventDefault(); setCurrentPage(item.name); }}
                                className={`flex items-center px-4 py-3 my-1 rounded-lg transition-colors duration-200 ${currentPage === item.name ? 'bg-blue-600 text-white' : 'hover:bg-gray-700'}`}>
                                {item.icon}
                                <span className="ml-4 font-medium">{item.name}</span>
                            </a>
                        ))}
                    </nav>
                </aside>
            );
        };

        const Header = ({ title }) => (
            <header className="flex justify-between items-center p-6 bg-white border-b border-gray-200">
                <h2 className="text-3xl font-bold text-gray-800">{title}</h2>
                <div className="flex items-center space-x-6">
                    <button className="relative text-gray-500 hover:text-gray-700"><Bell size={24} /></button>
                    <div className="flex items-center space-x-3">
                        <img src="https://placehold.co/40x40/4A5568/FFFFFF?text=SH" alt="User" className="w-10 h-10 rounded-full" />
                        <div>
                            <p className="font-semibold text-gray-800">Sarah Ho</p>
                            <p className="text-sm text-gray-500">HR Talent Manager</p>
                        </div>
                        <ChevronDown size={20} className="text-gray-500" />
                    </div>
                </div>
            </header>
        );

        const FilterSelect = ({ label, value, onChange, options, placeholder, disabled = false }) => (
            <div className="flex-1">
                <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                <select
                    value={value}
                    onChange={onChange}
                    disabled={disabled}
                    className="w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"
                >
                    <option value="">{placeholder}</option>
                    {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                </select>
            </div>
        );

        // --- DASHBOARD ---
        const Dashboard = ({ onSelectTalent }) => {
            const activeTalents = mockTalent.filter(t => t.status === 'Active');
            
            // --- Data for Stat Cards ---
            const highPotentialsCount = activeTalents.filter(t => t.potential >= 4.5).length;
            const today = new Date('2025-09-20T20:13:00+08:00');
            const oneYearAgo = new Date(today);
            oneYearAgo.setFullYear(today.getFullYear() - 1);
            const resignedLastYear = mockTalent.filter(t => t.status === 'Resigned' && new Date(t.resignationDate) > oneYearAgo && new Date(t.resignationDate) <= today).length;
            const avgHeadcount = (activeTalents.length + resignedLastYear + activeTalents.length) / 2;
            const turnoverRate = avgHeadcount > 0 ? ((resignedLastYear / avgHeadcount) * 100).toFixed(1) : 0;
            const turnoverHistory = [ { year: '2023', rate: 12.5 }, { year: '2024', rate: 15.0 }, { year: '2025', rate: turnoverRate } ];

            // --- Data for Talent Readiness Chart ---
            const highPotentials = activeTalents.filter(t => t.potential >= 4.0);
            const readinessDistribution = highPotentials.reduce((acc, t) => {
                const status = t.readiness || 'N/A';
                acc[status] = (acc[status] || 0) + 1;
                return acc;
            }, {});
            const readinessData = Object.keys(readinessDistribution)
              .map(key => ({ name: key, value: readinessDistribution[key] }))
              .sort((a,b) => a.name === 'Ready Now' ? -1 : 1); // Ensure consistent color order
            
            // --- Data for Department Distribution Chart ---
            const departmentDistribution = activeTalents.reduce((acc, t) => {
                acc[t.department] = (acc[t.department] || 0) + 1;
                return acc;
            }, {});
            const departmentData = Object.keys(departmentDistribution).map(key => ({ name: key, value: departmentDistribution[key] }));

            // --- Data for High Potentials to Watch ---
            const topTalents = [...activeTalents]
                .filter(t => t.potential >= 4.5 && t.performance >= 4.5)
                .sort((a, b) => (b.performance + b.potential) - (a.performance + a.potential))
                .slice(0, 5);

            // --- Data for Upcoming Anniversaries ---
            const upcomingAnniversaries = activeTalents.filter(t => {
                const joinDate = new Date(t.joinDate);
                const anniversaryDateThisYear = new Date(today.getFullYear(), joinDate.getMonth(), joinDate.getDate());
                if (anniversaryDateThisYear < today) {
                    anniversaryDateThisYear.setFullYear(today.getFullYear() + 1);
                }
                const threeMonthsFromNow = new Date(today);
                threeMonthsFromNow.setMonth(today.getMonth() + 3);
                return anniversaryDateThisYear >= today && anniversaryDateThisYear <= threeMonthsFromNow;
            }).sort((a, b) => {
                const anniversaryA = new Date(today.getFullYear(), new Date(a.joinDate).getMonth(), new Date(a.joinDate).getDate());
                if (anniversaryA < today) anniversaryA.setFullYear(today.getFullYear() + 1);
                const anniversaryB = new Date(today.getFullYear(), new Date(b.joinDate).getMonth(), new Date(b.joinDate).getDate());
                if (anniversaryB < today) anniversaryB.setFullYear(today.getFullYear() + 1);
                return anniversaryA - anniversaryB;
            }).slice(0, 5);


            const StatCard = ({ icon, label, value, color, unit = "" }) => (
                <div className="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                    <div className={`p-3 rounded-full ${color}`}>{icon}</div>
                    <div>
                        <p className="text-3xl font-bold text-gray-800">{value}<span className="text-xl font-semibold">{unit}</span></p>
                        <p className="text-gray-500 font-semibold">{label}</p>
                    </div>
                </div>
            );

            return (
                <div className="p-6 lg:p-8 bg-gray-50/50 min-h-full">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">

                        {/* Main content area */}
                        <div className="lg:col-span-2 space-y-6">
                            {/* Stat cards */}
                            <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6">
                                <StatCard icon={<Users size={24} className="text-white"/>} label="Active Talents" value={activeTalents.length} color="bg-blue-500"/>
                                <StatCard icon={<Star size={24} className="text-white"/>} label="High Potentials" value={highPotentialsCount} color="bg-yellow-500"/>
                                <StatCard icon={<Briefcase size={24} className="text-white"/>} label="Critical Roles" value={keyRolesData.length} color="bg-green-500"/>
                                <StatCard icon={<UserMinus size={24} className="text-white"/>} label="Annual Turnover" value={turnoverRate} unit="%" color="bg-red-500"/>
                            </div>

                            {/* Turnover Trend */}
                            <div className="bg-white p-6 rounded-xl shadow-md">
                                <h3 className="text-xl font-semibold text-gray-700 mb-4">Turnover Trend</h3>
                                <ResponsiveContainer width="100%" height={300}>
                                    <LineChart data={turnoverHistory}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="year" />
                                        <YAxis domain={[0, 25]} unit="%"/>
                                        <Tooltip formatter={(value) => `${value}%`}/>
                                        <Line type="monotone" dataKey="rate" stroke="#EF4444" strokeWidth={2} name="Turnover Rate"/>
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>

                            {/* Department Distribution */}
                            <div className="bg-white p-6 rounded-xl shadow-md">
                                <h3 className="text-xl font-semibold text-gray-700 mb-4">Talent Distribution by Department</h3>
                                <ResponsiveContainer width="100%" height={300}>
                                    <BarChart data={departmentData} layout="vertical" margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis type="number" />
                                        <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 12}}/>
                                        <Tooltip />
                                        <Bar dataKey="value" fill="#3B82F6" name="No. of Talents" />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Right sidebar */}
                        <div className="lg:col-span-1 space-y-6">
                            {/* Talent Readiness */}
                            <div className="bg-white p-6 rounded-xl shadow-md">
                                <h3 className="text-xl font-semibold text-gray-700 mb-4">High-Potential Talent Readiness</h3>
                                <ResponsiveContainer width="100%" height={250}>
                                    <PieChart>
                                        <Pie data={readinessData} dataKey="value" nameKey="name" cx="50%" cy="50%" innerRadius={60} outerRadius={90} labelLine={false} label={renderCustomizedLabel}>
                                            {readinessData.map((entry) => (<Cell key={entry.name} fill={COLORS[entry.name]} />))}
                                        </Pie>
                                        <Tooltip/>
                                        <Legend wrapperStyle={{fontSize: "14px"}}/>
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>

                            {/* High Potentials */}
                            <div className="bg-white p-6 rounded-xl shadow-md">
                                <h3 className="text-xl font-semibold text-gray-700 mb-4 flex items-center"><Sparkles size={20} className="mr-2 text-yellow-500"/>High Potentials to Watch</h3>
                                <div className="space-y-3">
                                    {topTalents.map(talent => (
                                        <div key={talent.id} className="flex items-center justify-between p-3 rounded-lg border border-transparent hover:border-gray-200 hover:bg-gray-50/80 transition-all">
                                            <div className="flex items-center space-x-3">
                                                <img src={talent.headshot} alt={talent.name} className="w-10 h-10 rounded-full"/>
                                                <div>
                                                    <p className="font-semibold text-gray-800 text-sm">{talent.name}</p>
                                                    <p className="text-xs text-gray-500">{talent.title}</p>
                                                </div>
                                            </div>
                                             <div className="flex items-center space-x-2">
                                                <button onClick={() => onSelectTalent(talent.id)} className="text-gray-400 hover:text-blue-600 p-2 rounded-full hover:bg-blue-50 transition-colors"><Eye size={16}/></button>
                                             </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Upcoming Anniversaries */}
                            <div className="bg-white p-6 rounded-xl shadow-md">
                                <h3 className="text-xl font-semibold text-gray-700 mb-4 flex items-center"><Gift size={20} className="mr-2 text-pink-500"/>Upcoming Anniversaries</h3>
                                 <div className="space-y-3">
                                    {upcomingAnniversaries.map(talent => {
                                        const tenure = calculateTenure(talent.joinDate);
                                        const anniversaryDate = new Date(today.getFullYear(), new Date(talent.joinDate).getMonth(), new Date(talent.joinDate).getDate());
                                        if (anniversaryDate < today) anniversaryDate.setFullYear(today.getFullYear() + 1);

                                        return (
                                            <div key={talent.id} className="flex items-center justify-between p-3 rounded-lg border border-transparent hover:border-gray-200 hover:bg-gray-50/80 transition-all">
                                                <div className="flex items-center space-x-3">
                                                    <img src={talent.headshot} alt={talent.name} className="w-10 h-10 rounded-full"/>
                                                    <div>
                                                        <p className="font-semibold text-gray-800 text-sm">{talent.name}</p>
                                                        <p className="text-xs text-gray-500">{anniversaryDate.toLocaleDateString('en-SG', {day:'numeric', month:'long'})} ({tenure.years + 1} years)</p>
                                                    </div>
                                                </div>
                                                <button onClick={() => onSelectTalent(talent.id)} className="text-gray-400 hover:text-blue-600 p-2 rounded-full hover:bg-blue-50 transition-colors"><Eye size={16}/></button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }


        const TalentDirectory = ({ onSelectTalent }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [filters, setFilters] = useState({ department: '', organisationalUnit: '', domain: '' });
            
            const activeTalents = mockTalent.filter(t => t.status === 'Active');

            const handleFilterChange = (filterName, value) => {
                setFilters(prev => {
                    const newFilters = { ...prev, [filterName]: value };
                    if (filterName === 'department') {
                        newFilters.organisationalUnit = '';
                    }
                    return newFilters;
                });
            };

            const resetFilters = () => {
                setFilters({ department: '', organisationalUnit: '', domain: '' });
                setSearchTerm('');
            };

            const filteredTalent = useMemo(() =>
                activeTalents.filter(t => {
                    const searchMatch = searchTerm === '' || t.name.toLowerCase().includes(searchTerm.toLowerCase());
                    const departmentMatch = filters.department ? t.department === filters.department : true;
                    const unitMatch = filters.organisationalUnit ? t.organisationalUnit === filters.organisationalUnit : true;
                    const domainMatch = filters.domain ? t.domain === filters.domain : true;
                    return searchMatch && departmentMatch && unitMatch && domainMatch;
                }), [searchTerm, filters]);

            const organisationalUnitOptions = filters.department ? filterOptions.organisationalUnit[filters.department] : [];

            return (
                <div className="p-8">
                    <div className="bg-white p-4 rounded-xl shadow-md mb-6">
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                            <div className="md:col-span-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Search by Name</label>
                                <div className="relative">
                                    <Search size={20} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" />
                                    <input
                                        type="text"
                                        placeholder="e.g., Li Wei Tan"
                                        className="bg-white border border-gray-300 rounded-md pl-10 pr-4 py-2 w-full focus:outline-none focus:ring-1 focus:ring-blue-500"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                            </div>
                            <FilterSelect
                                label="Department/Division"
                                value={filters.department}
                                onChange={(e) => handleFilterChange('department', e.target.value)}
                                options={filterOptions.department}
                                placeholder="All Departments"
                            />
                            <FilterSelect
                                label="Organisational Unit/Team"
                                value={filters.organisationalUnit}
                                onChange={(e) => handleFilterChange('organisationalUnit', e.target.value)}
                                options={organisationalUnitOptions}
                                placeholder="Select Department First"
                                disabled={!filters.department}
                            />
                            <FilterSelect
                                label="Domain"
                                value={filters.domain}
                                onChange={(e) => handleFilterChange('domain', e.target.value)}
                                options={filterOptions.domain}
                                placeholder="All Domains"
                            />
                            <div className="flex space-x-2">
                                <button onClick={resetFilters} className="flex-1 flex items-center justify-center bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 font-semibold">
                                    <RotateCcw size={16} className="mr-2"/> Reset
                                </button>
                            </div>
                        </div>
                    </div>
                    <div className="flex justify-between items-center mb-4">
                            <p className="text-sm text-gray-600">Showing <span className="font-bold">{filteredTalent.length}</span> of <span className="font-bold">{activeTalents.length}</span> talents</p>
                            <button className="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"><Plus size={16} className="mr-2" /> Add New Talent</button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {filteredTalent.map(talent => (
                            <div key={talent.id} className="bg-white rounded-xl shadow-md flex flex-col justify-between transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                                <div className="p-5 text-center">
                                    <img src={talent.headshot} alt={talent.name} className="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-gray-100" />
                                    <h4 className="text-lg font-bold text-gray-800">{talent.name}</h4>
                                    <p className="text-gray-500 text-sm">{talent.title}</p>
                                    <div className="text-xs text-gray-500 mt-2 space-y-1 text-left px-2">
                                        <p className="flex items-center"><Briefcase size={12} className="mr-2 flex-shrink-0"/>{talent.department}</p>
                                        <p className="flex items-center"><Building size={12} className="mr-2 flex-shrink-0"/>{talent.organisationalUnit}</p>
                                        <p className="flex items-center"><Globe size={12} className="mr-2 flex-shrink-0"/>{talent.domain}</p>
                                    </div>
                                    <hr className="my-4"/>
                                    <div className="flex justify-around items-center text-sm">
                                        <div className="text-center"><p className="font-bold text-blue-600">{talent.performance}</p><p className="text-gray-400 text-xs">Perf.</p></div>
                                        <div className="text-center"><p className="font-bold text-green-600">{talent.potential}</p><p className="text-gray-400 text-xs">Pot.</p></div>
                                        <div className="text-center"><span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${talent.development_scheme === 'MLDP' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>{talent.development_scheme}</span></div>
                                    </div>
                                </div>
                                <div className="p-4 bg-gray-50 rounded-b-xl mt-auto"><button onClick={() => onSelectTalent(talent.id)} className="w-full flex items-center justify-center bg-blue-100 text-blue-700 hover:bg-blue-200 font-semibold px-4 py-2 rounded-lg text-sm">View Profile <Eye size={16} className="ml-2" /></button></div>
                            </div>
                        ))}
                    </div>
                    {filteredTalent.length === 0 && <div className="text-center py-16 bg-white rounded-xl shadow-md"><h3 className="text-xl font-semibold text-gray-700">No Talents Found</h3><p className="text-gray-500 mt-2">Try adjusting your search or filter criteria.</p></div>}
                </div>
            );
        };

        // --- MODAL COMPONENT ---
        const AddEventModal = ({ onSave, onCancel }) => {
            const [eventType, setEventType] = useState('Milestone');
            const [title, setTitle] = useState('');
            const [date, setDate] = useState('');
            const [description, setDescription] = useState('');

            const handleSave = () => {
                if (!title || !date || !description) {
                    console.error("Please fill in all fields.");
                    return;
                }
                onSave({ type: eventType, title, date, description });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-xl shadow-lg p-8 w-full max-w-lg">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-2xl font-bold text-gray-800">Add New Career Event</h3>
                            <button onClick={onCancel} className="text-gray-400 hover:text-gray-600"><X size={24} /></button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Event Type</label>
                                <select value={eventType} onChange={e => setEventType(e.target.value)} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                    <option>Milestone</option>
                                    <option>Deployment</option>
                                    <option>Secondment</option>
                                    <option>Gig Work</option>
                                    <option>Promotion</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Title</label>
                                <input type="text" value={title} onChange={e => setTitle(e.target.value)} placeholder="e.g., Future Leaders Programme" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Date</label>
                                <input type="date" value={date} onChange={e => setDate(e.target.value)} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Description</label>
                                <textarea value={description} onChange={e => setDescription(e.target.value)} rows="3" placeholder="A brief summary of the event or achievement." className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                        </div>
                        <div className="mt-8 flex justify-end space-x-4">
                            <button onClick={onCancel} className="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold">Cancel</button>
                            <button onClick={handleSave} className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-semibold">Save Event</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Talent Profile Modal Component ---
        const TalentProfileModal = ({ talent, onClose, onViewFullProfile, targetRole }) => {
            if (!talent) return null;

            const InfoCard = ({ icon, label, value }) => (
                <div className="bg-gray-50 p-3 rounded-lg flex items-start">
                    <div className="flex-shrink-0 h-7 w-7 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-3 mt-1">
                        {icon}
                    </div>
                    <div>
                        <p className="text-xs text-gray-500">{label}</p>
                        <p className="font-semibold text-gray-800 break-words text-sm">{value}</p>
                    </div>
                </div>
            );

            const talentCompetencies = new Set([...talent.competencies.foundational, ...talent.competencies.functional]);
            const requiredCompetencies = new Set(targetRole?.competencies || []);
            const matchedCompetencies = [...talentCompetencies].filter(c => requiredCompetencies.has(c));
            const gapCompetencies = [...requiredCompetencies].filter(c => !talentCompetencies.has(c));


            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                        {/* Header */}
                        <div className="p-6 border-b flex justify-between items-start">
                            <div className="flex items-center space-x-4">
                                <img src={talent.headshot} alt={talent.name} className="w-20 h-20 rounded-full border-4 border-blue-100" />
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800">{talent.name}</h2>
                                    <p className="text-lg text-gray-500">{talent.title}</p>
                                    <div className="mt-2 flex flex-wrap gap-2">
                                        {talent.tags.map(tag => <span key={tag} className="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{tag}</span>)}
                                    </div>
                                </div>
                            </div>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
                                <X size={24} />
                            </button>
                        </div>
                        
                        {/* Content */}
                        <div className="p-6 overflow-y-auto space-y-6">
                            <div>
                                <h4 className="text-md font-semibold text-gray-700 border-b pb-2 mb-4">Talent Snapshot</h4>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        <InfoCard icon={<TrendingUp size={16}/>} label="Performance" value={talent.performance.toFixed(1)} />
                                        <InfoCard icon={<Star size={16}/>} label="Potential" value={talent.potential.toFixed(1)} />
                                        <InfoCard icon={<CheckCircle size={16}/>} label="Readiness" value={talent.readiness} />
                                        <InfoCard icon={<Briefcase size={16}/>} label="Department" value={talent.department} />
                                        <InfoCard icon={<Building size={16}/>} label="Org. Unit" value={talent.organisationalUnit} />
                                        <InfoCard icon={<Globe size={16}/>} label="Domain" value={talent.domain} />
                                </div>
                            </div>

                            {targetRole && (
                                    <div>
                                        <h4 className="text-md font-semibold text-gray-700 border-b pb-2 mb-4">Competency Fit for <span className="text-blue-600">{targetRole.title}</span></h4>
                                        {gapCompetencies.length > 0 && (
                                            <div className="mb-3">
                                                    <h5 className="text-sm font-bold text-gray-600 mb-2">Development Gaps</h5>
                                                    <div className="flex flex-wrap gap-2">
                                                        {gapCompetencies.map(c => <span key={c} className="bg-red-100 text-red-800 text-sm font-medium px-3 py-1 rounded-full flex items-center"><AlertTriangle size={14} className="mr-1.5"/>{c}</span>)}
                                                    </div>
                                            </div>
                                        )}
                                        {matchedCompetencies.length > 0 && (
                                            <div>
                                                    <h5 className="text-sm font-bold text-gray-600 mb-2">Matched Competencies</h5>
                                                    <div className="flex flex-wrap gap-2">
                                                        {matchedCompetencies.map(c => <span key={c} className="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full flex items-center"><Check size={14} className="mr-1.5"/>{c}</span>)}
                                                    </div>
                                            </div>
                                        )}
                                    </div>
                            )}


                            <div>
                                <h4 className="text-md font-semibold text-gray-700 border-b pb-2 mb-4">Career Aspirations</h4>
                                <p className="text-gray-700 italic">"{talent.careerAspirations}"</p>
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="p-4 bg-gray-50 border-t mt-auto">
                            <button 
                                onClick={() => onViewFullProfile(talent.id)} 
                                className="w-full bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-semibold flex items-center justify-center"
                            >
                                View Full Profile <ChevronsRight size={16} className="ml-2" />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };


        // ProfilePage Component
        const ProfilePage = ({ talent, onBack, onUpdateTalent }) => {
            const [activeTab, setActiveTab] = useState('Officer Profile');
            const [activeSubTab, setActiveSubTab] = useState('Talent Snapshot');
            const journeyEventTypes = ['Promotion', 'Milestone', 'Deployment', 'Secondment', 'Gig Work'];
            const [journeyFilters, setJourneyFilters] = useState(journeyEventTypes);
            const [isFilterOpen, setIsFilterOpen] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [newRemark, setNewRemark] = useState("");

            const handleAddRemark = () => {
                if (newRemark.trim() === "") return;
                const remark = {
                    date: new Date().toISOString().split('T')[0],
                    author: 'Sarah Ho', // In a real app, this would be the logged-in user
                    text: newRemark.trim(),
                };
                const updatedTalent = {
                    ...talent,
                    remarks: [...talent.remarks, remark]
                };
                onUpdateTalent(updatedTalent);
                setNewRemark("");
            };

            const handleFilterToggle = (type) => {
                setJourneyFilters(prev =>
                    prev.includes(type) ? prev.filter(t => t !== type) : [...prev, type]
                );
            };

            const journeyEventConfig = {
                'Promotion': { icon: <ArrowUpCircle size={18} />, color: 'green' },
                'Milestone': { icon: <Award size={18} />, color: 'purple' },
                'Deployment': { icon: <Briefcase size={18} />, color: 'blue' },
                'Secondment': { icon: <Globe size={18} />, color: 'teal' },
                'Gig Work': { icon: <Zap size={18} />, color: 'orange' }
            };

            const InfoCard = ({ icon, label, value }) => (
                <div className="bg-gray-50 p-4 rounded-lg flex items-start">
                    <div className="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-4 mt-1">
                        {icon}
                    </div>
                    <div>
                        <p className="text-sm text-gray-500">{label}</p>
                        <p className="font-semibold text-gray-800 break-words">{value}</p>
                    </div>
                </div>
            );

            const InsightCloud = ({ feedback }) => {
                const competencyKeywords = ['leadership', 'collaboration', 'analytical', 'communication', 'mentoring', 'execution', 'strategic', 'innovation'];
                const aspirationKeywords = ['lead', 'manage', 'mentor', 'training', 'strategies', 'policy-making', 'digital transformation'];

                const extractKeywords = (text, keywordList) => {
                    const words = text.toLowerCase().replace(/[.,!?]/g, '').split(/\s+/);
                    const freq = words.reduce((acc, word) => {
                        const foundKeyword = keywordList.find(kw => word.includes(kw));
                        if (foundKeyword) {
                            acc[foundKeyword] = (acc[foundKeyword] || 0) + 1;
                        }
                        return acc;
                    }, {});
                    return Object.entries(freq).sort((a,b) => b[1] - a[1]);
                };

                const feedbackText = feedback.map(f => f.summary).join(' ');
                const competencyCloud = extractKeywords(feedbackText, competencyKeywords);
                const aspirationCloud = extractKeywords(feedbackText, aspirationKeywords);

                return (
                    <div className="p-4 bg-gray-50 rounded-lg">
                        <h4 className="font-bold text-gray-700 mb-4">Insight Cloud</h4>
                        <div>
                            <h5 className="font-semibold text-gray-600 text-sm mb-2">Observed Competencies</h5>
                            <div className="flex flex-wrap gap-2">
                                {competencyCloud.length > 0 ? competencyCloud.map(([word]) => (
                                    <span key={word} className="bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full capitalize">{word}</span>
                                )) : <p className="text-sm text-gray-500">No core competencies mentioned in feedback.</p>}
                            </div>
                        </div>
                        <hr className="my-4" />
                        <div>
                            <h5 className="font-semibold text-gray-600 text-sm mb-2">Stated Aspirations (from Feedback)</h5>
                            <div className="flex flex-wrap gap-2">
                                    {aspirationCloud.length > 0 ? aspirationCloud.map(([word]) => (
                                    <span key={word} className="bg-green-100 text-green-800 text-sm font-medium px-2.5 py-0.5 rounded-full capitalize">{word}</span>
                                )) : <p className="text-sm text-gray-500">No specific aspirations mentioned in feedback.</p>}
                            </div>
                        </div>
                    </div>
                );
            };

            const groupedJourneyEvents = talent.careerJourneyEvents
                .filter(event => journeyFilters.includes(event.type))
                .sort((a,b) => new Date(b.date) - new Date(a.date))
                .reduce((acc, event) => {
                    const year = new Date(event.date).getFullYear();
                    if (!acc[year]) acc[year] = [];
                    acc[year].push(event);
                    return acc;
                }, {});

            const sortedYears = Object.keys(groupedJourneyEvents).sort((a, b) => b - a);

            return(
                <>
                {isModalOpen && <AddEventModal onSave={(event) => { console.log(event); setIsModalOpen(false); }} onCancel={() => setIsModalOpen(false)} />}
                <div className="p-8">
                    <button onClick={onBack} className="mb-6 text-blue-600 hover:underline">&larr; Back to Talent Directory</button>
                    <div className="bg-white rounded-xl shadow-md p-8">
                        {/* Profile Header */}
                        <div className="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                            <img src={talent.headshot} alt={talent.name} className="w-32 h-32 rounded-full border-4 border-blue-200" />
                            <div className="flex-1 text-center md:text-left">
                                <h2 className="text-3xl font-bold text-gray-800">{talent.name}</h2>
                                <p className="text-xl text-gray-500">{talent.title}</p>
                                <div className="mt-2 flex flex-wrap justify-center md:justify-start gap-2">
                                    {talent.tags.map(tag => <span key={tag} className="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{tag}</span>)}
                                </div>
                            </div>
                            <div className="flex flex-col gap-2">
                                <button className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Edit Profile</button>
                                <button className="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300">Download Resume</button>
                            </div>
                        </div>
                            {/* Main Tabs */}
                        <div className="mt-8 border-b border-gray-200">
                            <nav className="-mb-px flex space-x-8">
                                <button onClick={() => setActiveTab('Officer Profile')} className={`py-4 px-1 border-b-2 font-medium text-sm flex items-center ${activeTab === 'Officer Profile' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}><User size={16} className="mr-2"/>Officer Profile</button>
                                <button onClick={() => setActiveTab('Career Journey')} className={`py-4 px-1 border-b-2 font-medium text-sm flex items-center ${activeTab === 'Career Journey' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}><GitBranch size={16} className="mr-2"/>Career Journey</button>
                                <button onClick={() => setActiveTab('Feedback Loop')} className={`py-4 px-1 border-b-2 font-medium text-sm flex items-center ${activeTab === 'Feedback Loop' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}><MessageCircle size={16} className="mr-2"/>Feedback Loop</button>
                                <button onClick={() => setActiveTab('Comments')} className={`py-4 px-1 border-b-2 font-medium text-sm flex items-center ${activeTab === 'Comments' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}><MessageSquare size={16} className="mr-2"/>Comments</button>
                            </nav>
                        </div>
                            {/* Tab Content */}
                            <div className="mt-8">
                                {activeTab === 'Officer Profile' && (
                                    <div>
                                        <div className="mb-8 flex justify-center">
                                            <div className="bg-gray-100 p-1 rounded-full inline-flex space-x-1 border">
                                                <button onClick={() => setActiveSubTab('Talent Snapshot')} className={`px-6 py-2 text-sm font-semibold rounded-full transition-colors ${activeSubTab === 'Talent Snapshot' ? 'bg-white text-blue-600 shadow' : 'text-gray-600 hover:bg-gray-200'}`}>Talent Snapshot</button>
                                                <button onClick={() => setActiveSubTab('Personnel Information')} className={`px-6 py-2 text-sm font-semibold rounded-full transition-colors ${activeSubTab === 'Personnel Information' ? 'bg-white text-blue-600 shadow' : 'text-gray-600 hover:bg-gray-200'}`}>Personnel Information</button>
                                            </div>
                                        </div>

                                        {activeSubTab === 'Talent Snapshot' && (
                                            <div className="space-y-10 animate-fadeIn">
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Current Role & Performance</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                        <InfoCard icon={<Briefcase size={18}/>} label="Department" value={talent.department} />
                                                        <InfoCard icon={<Building size={18}/>} label="Organisational Unit" value={talent.organisationalUnit} />
                                                        <InfoCard icon={<Globe size={18}/>} label="Domain" value={talent.domain} />
                                                        <InfoCard icon={<TrendingUp size={18}/>} label="Latest Performance" value={talent.performance.toFixed(1)} />
                                                        <InfoCard icon={<Star size={18}/>} label="Latest Potential" value={talent.potential.toFixed(1)} />
                                                        <InfoCard icon={<CheckCircle size={18}/>} label="Development Scheme" value={talent.development_scheme} />
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Development Plan</h4>
                                                    <div className="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                                                        <div>
                                                            <p className="font-semibold text-gray-800">HR Kaki Career Plan</p>
                                                            <p className="text-sm text-gray-600">This officer's development plan is managed in HR Kaki.</p>
                                                        </div>
                                                        <a href={talent.hrKakiPlanUrl} target="_blank" rel="noopener noreferrer" className="inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold transition-colors text-sm">
                                                            View Plan <ExternalLink size={16} className="ml-2" />
                                                        </a>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Competencies</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                                        <div>
                                                            <h5 className="font-bold text-gray-600 mb-2">Foundational Functional (FFCs)</h5>
                                                            <div className="flex flex-wrap gap-2">
                                                                {talent.competencies.foundational.map(c => <span key={c} className="bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1 rounded-full">{c}</span>)}
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <h5 className="font-bold text-gray-600 mb-2">Functional (FCs)</h5>
                                                            <div className="flex flex-wrap gap-2">
                                                                {talent.competencies.functional.map(c => <span key={c} className="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">{c}</span>)}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Performance History</h4>
                                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                                        <div className="lg:col-span-2 bg-gray-50 p-4 rounded-lg">
                                                            <h5 className="font-bold text-gray-700 mb-2">Performance Trend</h5>
                                                            <ResponsiveContainer width="100%" height={200}>
                                                                <LineChart data={talent.performanceHistory}>
                                                                    <CartesianGrid strokeDasharray="3 3" />
                                                                    <XAxis dataKey="year" />
                                                                    <YAxis domain={[1, 5]}/>
                                                                    <Tooltip />
                                                                    <Line type="monotone" dataKey="score" stroke="#3B82F6" strokeWidth={2} name="Score"/>
                                                                </LineChart>
                                                            </ResponsiveContainer>
                                                        </div>
                                                        <div className="bg-gray-50 p-4 rounded-lg">
                                                            <h5 className="font-bold text-gray-700 mb-2">Scores by Year</h5>
                                                            <table className="w-full text-sm">
                                                                <thead><tr className="border-b"><th className="text-left font-semibold text-gray-600 p-2">Year</th><th className="text-right font-semibold text-gray-600 p-2">Score</th></tr></thead>
                                                                <tbody>{talent.performanceHistory.map(p => (<tr key={p.year}><td className="p-2 text-gray-700">{p.year}</td><td className="p-2 text-right font-bold text-gray-800">{p.score.toFixed(1)}</td></tr>))}</tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Experience</h4>
                                                    <div className="space-y-6 relative border-l-2 border-gray-200 ml-3 pt-4">
                                                        {talent.careerHistory.map((item, index) => (<div key={index} className="pl-8 relative"><div className="absolute -left-[11px] top-1 w-5 h-5 bg-green-500 rounded-full border-4 border-white"></div><p className="font-bold text-gray-800">{item.role}</p><p className="text-sm text-gray-500">{item.department}</p><p className="text-xs text-gray-400 mt-1">{new Date(item.startDate).toLocaleDateString('en-SG', {year:'numeric', month:'short'})} - {item.endDate === 'Present' ? 'Present' : new Date(item.endDate).toLocaleDateString('en-SG', {year:'numeric', month:'short'})}</p></div>))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        {activeSubTab === 'Personnel Information' && (
                                            <div className="space-y-10 animate-fadeIn">
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Employment Details</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                        <InfoCard icon={<Calendar size={18}/>} label="Join Date" value={new Date(talent.joinDate).toLocaleDateString('en-SG', { year: 'numeric', month: 'long', day: 'numeric' })} />
                                                        <InfoCard icon={<Clock size={18}/>} label="Tenure" value={calculateTenure(talent.joinDate).years + " years, " + calculateTenure(talent.joinDate).months + " months"} />
                                                        <InfoCard icon={<FileText size={18}/>} label="Employment Type" value={talent.employmentType} />
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Organizational Details</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                        <InfoCard icon={<User size={18}/>} label="Reporting Manager" value={talent.manager} />
                                                        <InfoCard icon={<BarChart2 size={18}/>} label="Job Grade" value={talent.jobGrade} />
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Education</h4>
                                                    <InfoCard icon={<GraduationCap size={18}/>} label="Highest Qualification" value={talent.education} />
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Licenses & Certifications</h4>
                                                    <InfoCard icon={<Award size={18}/>} label="Certifications" value={talent.certifications.join(', ')} />
                                                </div>
                                                <div>
                                                    <h4 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Contact & Personal Details</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                        <InfoCard icon={<Mail size={18}/>} label="Email" value={talent.email} />
                                                        <InfoCard icon={<Phone size={18}/>} label="Phone" value={talent.phone} />
                                                        <InfoCard icon={<Shield size={18}/>} label="Emergency Contact" value={`${talent.emergencyContact.name} (${talent.emergencyContact.relation}) - ${talent.emergencyContact.phone}`} />
                                                        <InfoCard icon={<Calendar size={18}/>} label="Age" value={`${talent.age} years old`} />
                                                        <InfoCard icon={<Star size={18}/>} label="Scholar Status" value={talent.scholar ? 'Yes' : 'No'} />
                                                        <InfoCard icon={<User size={18}/>} label="Employee ID" value={talent.employeeId} />
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                                {activeTab === 'Career Journey' && (
                                    <div>
                                            <div className="flex justify-between items-center bg-gray-50 p-3 rounded-xl mb-6 border">
                                                <div className="relative">
                                                    <button onClick={() => setIsFilterOpen(!isFilterOpen)} className="flex items-center bg-white text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-100 border font-semibold">
                                                        <Filter size={16} className="mr-2"/> Filter Events <ChevronDown size={16} className={`ml-2 transition-transform ${isFilterOpen ? 'rotate-180' : ''}`}/>
                                                    </button>
                                                    {isFilterOpen && (
                                                        <div className="absolute top-full mt-2 w-56 bg-white rounded-lg shadow-lg border z-10">
                                                            <div className="p-4 space-y-2">
                                                                {journeyEventTypes.map(type => (
                                                                    <label key={type} className="flex items-center space-x-2 cursor-pointer">
                                                                        <input type="checkbox" checked={journeyFilters.includes(type)} onChange={() => handleFilterToggle(type)} className="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"/>
                                                                        <span>{type}</span>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                                <button onClick={() => setIsModalOpen(true)} className="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold"><Plus size={16} className="mr-2" /> Add New Event</button>
                                            </div>
                                            {sortedYears.map(year => (
                                                <div key={year} className="mb-8">
                                                    <h3 className="text-2xl font-bold text-gray-400 pl-6 pb-2 border-l-2 border-gray-200">{year}</h3>
                                                    <div className="space-y-8 relative border-l-2 border-gray-200 ml-6">
                                                        {groupedJourneyEvents[year].map((item, index) => {
                                                            const config = journeyEventConfig[item.type] || { icon: <Info size={18}/>, color: 'gray' };
                                                            const colorClasses = { green: 'bg-green-500', purple: 'bg-purple-500', blue: 'bg-blue-500', teal: 'bg-teal-500', orange: 'bg-orange-500', gray: 'bg-gray-500' };
                                                            return (
                                                                <div key={index} className="pl-12 relative">
                                                                    <div className={`absolute -left-4 top-1 w-8 h-8 ${colorClasses[config.color]} text-white rounded-full flex items-center justify-center border-4 border-white`}>
                                                                        {config.icon}
                                                                    </div>
                                                                    <p className="text-xs text-gray-500 font-semibold">{new Date(item.date).toLocaleDateString('en-SG', { month: 'long', day: 'numeric' })}</p>
                                                                    <p className={`text-sm font-bold text-gray-500`}>{item.type}</p>
                                                                    <h4 className="font-bold text-lg text-gray-800">{item.title}</h4>
                                                                    <p className="text-gray-600 mt-1">{item.description}</p>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            ))}
                                            {sortedYears.length === 0 && <div className="text-center py-10"><p className="text-gray-500">No events match the selected filters.</p></div>}
                                    </div>
                                )}
                                {activeTab === 'Feedback Loop' && (
                                    <div>
                                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Feedback Insights</h3>
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                            <div className="p-4 bg-gray-50 rounded-lg">
                                                <h4 className="font-bold text-gray-700 mb-2">Sentiment Over Time</h4>
                                                <ResponsiveContainer width="100%" height={200}>
                                                    <AreaChart data={talent.feedback.map(f => ({date: f.date, score: f.sentimentScore})).sort((a,b) => new Date(a.date) - new Date(b.date))}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="date" tickFormatter={(d) => new Date(d).getFullYear()} />
                                                        <YAxis domain={[0, 1]}/>
                                                        <Tooltip />
                                                        <Area type="monotone" dataKey="score" stroke="#3B82F6" fill="#BFDBFE" name="Sentiment Score"/>
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            </div>
                                            <InsightCloud feedback={talent.feedback} />
                                        </div>

                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-xl font-semibold text-gray-700">Feedback History</h3>
                                            <button className="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"><Plus size={16} className="mr-2"/> Collect New Feedback</button>
                                        </div>
                                        <div className="space-y-4">
                                            {talent.feedback.map((fb, i) => (
                                                <div key={i} className="p-4 border rounded-lg bg-white">
                                                    <div className="flex justify-between items-center"><h4 className="font-bold text-gray-800">{fb.formName}</h4><span className="text-sm text-gray-500">{fb.date}</span></div>
                                                    <p className="text-gray-600 mt-2 italic">"{fb.summary}"</p>
                                                    <div className={`mt-2 inline-flex items-center text-sm font-semibold ${fb.sentiment === 'Positive' ? 'text-green-600' : 'text-yellow-600'}`}>{fb.sentiment} Sentiment</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'Comments' && (
                                    <div className="space-y-6">
                                        <div>
                                            <h4 className="text-lg font-semibold text-gray-700 mb-2">Add a New Comment</h4>
                                            <textarea 
                                                value={newRemark}
                                                onChange={(e) => setNewRemark(e.target.value)}
                                                rows="4" 
                                                placeholder="Type your confidential comments here..." 
                                                className="w-full border border-gray-300 rounded-md shadow-sm p-3 focus:outline-none focus:ring-1 focus:ring-blue-500"
                                            ></textarea>
                                            <div className="text-right mt-2">
                                                <button onClick={handleAddRemark} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold">Save Comment</button>
                                            </div>
                                        </div>
                                        <div className="space-y-4">
                                        <h4 className="text-lg font-semibold text-gray-700 border-b pb-2">Comment History</h4>
                                        {talent.remarks.length > 0 ? (
                                            talent.remarks.sort((a,b) => new Date(b.date) - new Date(a.date)).map((remark, index) => (
                                                <div key={index} className="p-4 border rounded-lg bg-gray-50">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <p className="font-semibold text-gray-800">Comment by {remark.author}</p>
                                                        <p className="text-sm text-gray-500">{new Date(remark.date).toLocaleDateString('en-SG', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                                    </div>
                                                    <p className="text-gray-700">{remark.text}</p>
                                                </div>
                                            ))
                                        ) : (
                                            <p className="text-gray-500 text-center py-8">No comments have been added for this talent.</p>
                                        )}
                                        </div>
                                    </div>
                                )}
                            </div>
                    </div>
                </div>
                </>
            );
        };

        // --- 9-Box Grid Component ---
        const NineBoxGrid = ({ talentData, onSelectTalent, targetRole }) => {
            const getBoxForTalent = (talent) => {
                const perf = talent.performance;
                const pot = talent.potential;
                
                let perfBox = perf < 4.0 ? 0 : (perf < 4.5 ? 1 : 2);
                let potBox = pot < 4.0 ? 2 : (pot < 4.5 ? 1 : 0);
                
                return { row: potBox, col: perfBox };
            };

            const boxes = Array(3).fill(null).map(() => Array(3).fill(null).map(() => []));
            talentData.forEach(t => {
                const { row, col } = getBoxForTalent(t);
                boxes[row][col].push(t);
            });

            const boxLabels = [
                ['Enigma / Gem', 'High Potential', 'Star'],
                ['Inconsistent Player', 'Core Player', 'High Performer'],
                ['Risk', 'Average Performer', 'Solid Performer']
            ];
            const boxColors = [
                ['bg-yellow-50', 'bg-green-50', 'bg-green-100'],
                ['bg-orange-50', 'bg-blue-50', 'bg-blue-100'],
                ['bg-red-50', 'bg-gray-50', 'bg-gray-100']
            ];

            const potentialLabels = ['High Potential', 'Medium Potential', 'Low Potential'];


            return (
                <div className="p-8">
                        <div className="bg-blue-50 border border-blue-200 text-blue-800 p-4 rounded-lg mb-6">
                            <h4 className="font-bold">Talent Grid View</h4>
                            <p className="text-sm mt-1">This 9-Box Grid helps you visualize your talent landscape by plotting individuals based on their past performance and future potential. Use it to identify key segments like future leaders (Stars), steady contributors (Core Players), and individuals needing development.</p>
                        </div>
                    <div className="grid grid-cols-[auto,1fr,1fr,1fr] grid-rows-[auto,1fr,1fr,1fr] gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden">
                        {/* Top Row: Blank cell + Performance Headers */}
                        <div className="bg-white"></div>
                        <div className="p-4 text-center bg-white font-bold text-gray-600">Low Performance</div>
                        <div className="p-4 text-center bg-white font-bold text-gray-600">Medium Performance</div>
                        <div className="p-4 text-center bg-white font-bold text-gray-600">High Performance</div>

                        {/* Subsequent Rows: Potential Label + Grid Cells */}
                        {boxes.map((row, rowIndex) => (
                            <React.Fragment key={rowIndex}>
                                {/* Potential Label */}
                                <div className="p-4 flex items-center justify-center bg-white">
                                    <span className="font-bold text-gray-600 whitespace-nowrap -rotate-90">{potentialLabels[rowIndex]}</span>
                                </div>
                                {/* Data Cells for the row */}
                                {row.map((talents, colIndex) => (
                                    <div key={`${rowIndex}-${colIndex}`} className={`p-4 min-h-[150px] ${boxColors[rowIndex][colIndex]}`}>
                                        <h4 className="font-bold text-gray-800 text-sm mb-2">{boxLabels[rowIndex][colIndex]} <span className="font-normal text-gray-500">({talents.length})</span></h4>
                                        <div className="flex flex-wrap gap-2">
                                            {talents.map(t => (
                                                <div key={t.id} className="group relative">
                                                    <img 
                                                        src={t.headshot} 
                                                        alt={t.name}
                                                        className="w-10 h-10 rounded-full cursor-pointer border-2 border-white hover:ring-2 hover:ring-blue-500 transition-all"
                                                        onClick={() => onSelectTalent(t)}
                                                    />
                                                    <div className="absolute bottom-full z-10 mb-2 w-max bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                                        {t.name}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </React.Fragment>
                        ))}
                    </div>
                </div>
            );
        };

        // --- Candidate Comparison Modal Component ---
        const CandidateComparisonModal = ({ candidateIds, allTalent, onClose, targetRole }) => {
            const candidates = allTalent.filter(t => candidateIds.includes(t.id));

            const DetailSection = ({ title, children }) => (
                <div className="border-t border-gray-200 pt-3 mt-3">
                    <h5 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">{title}</h5>
                    {children}
                </div>
            );

            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-7xl h-[90vh] flex flex-col">
                        {/* Header */}
                        <div className="p-4 border-b flex justify-between items-center flex-shrink-0">
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800">Candidate Comparison</h2>
                                    <p className="text-sm text-gray-500">Comparing candidates for <span className="font-semibold text-blue-600">{targetRole.title}</span></p>
                                </div>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
                                <X size={24} />
                            </button>
                        </div>
                        {/* Comparison Grid */}
                        <div className="flex flex-1 overflow-hidden">
                            {candidates.map((talent, index) => {
                                const talentCompetencies = new Set([...talent.competencies.foundational, ...talent.competencies.functional]);
                                const requiredCompetencies = new Set(targetRole?.competencies || []);
                                const matchedCompetencies = [...talentCompetencies].filter(c => requiredCompetencies.has(c));
                                const gapCompetencies = [...requiredCompetencies].filter(c => !talentCompetencies.has(c));

                                return (
                                    <div key={talent.id} className={`flex flex-col flex-1 bg-white p-4 ${index < candidates.length - 1 ? 'border-r border-gray-200' : ''}`}>
                                        <div className="text-center mb-4 flex-shrink-0">
                                            <img src={talent.headshot} alt={talent.name} className="w-20 h-20 rounded-full mx-auto border-4 border-gray-100" />
                                            <h3 className="text-lg font-bold text-gray-800 mt-2">{talent.name}</h3>
                                            <p className="text-sm text-gray-500">{talent.title}</p>
                                        </div>
                                        <div className="overflow-y-auto pr-2 space-y-3 flex-1">
                                            <DetailSection title="Key Metrics">
                                                <div className="flex justify-around text-center">
                                                    <div><p className="font-bold text-blue-600 text-lg">{talent.performance.toFixed(1)}</p><p className="text-xs text-gray-400">Perf.</p></div>
                                                    <div><p className="font-bold text-green-600 text-lg">{talent.potential.toFixed(1)}</p><p className="text-xs text-gray-400">Pot.</p></div>
                                                </div>
                                                <div className="mt-2 text-center">
                                                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${talent.readiness === 'Ready Now' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}`}>{talent.readiness}</span>
                                                </div>
                                            </DetailSection>

                                            <DetailSection title="Competency Fit">
                                                <div className="space-y-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {matchedCompetencies.map(c => <span key={c} className="bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded-full flex items-center"><Check size={12} className="mr-1"/>{c}</span>)}
                                                    </div>
                                                    <div className="flex flex-wrap gap-1">
                                                        {gapCompetencies.map(c => <span key={c} className="bg-red-100 text-red-800 text-xs font-medium px-2 py-0.5 rounded-full flex items-center"><AlertTriangle size={12} className="mr-1"/>{c}</span>)}
                                                    </div>
                                                </div>
                                            </DetailSection>

                                            <DetailSection title="Career History (Last 2 Roles)">
                                                <ul className="space-y-2 text-sm">
                                                    {talent.careerHistory.slice(0, 2).map((item, i) => (
                                                        <li key={i}>
                                                            <p className="font-semibold text-gray-700">{item.role}</p>
                                                            <p className="text-xs text-gray-500">{item.department}</p>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </DetailSection>

                                            <DetailSection title="Career Aspirations">
                                                <p className="text-sm text-gray-600 italic">"{talent.careerAspirations}"</p>
                                            </DetailSection>
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Role Profile Modal ---
        const RoleProfileModal = ({ role, allCompetencies, onSave, onCancel }) => {
            const [selectedCompetencies, setSelectedCompetencies] = useState(role.competencies || []);

            const handleToggleCompetency = (competency) => {
                setSelectedCompetencies(prev => 
                    prev.includes(competency) 
                        ? prev.filter(c => c !== competency)
                        : [...prev, competency]
                );
            };

            const handleSave = () => {
                onSave({ ...role, competencies: selectedCompetencies });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
                        <div className="p-6 border-b flex justify-between items-start">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800">Manage Role Profile</h2>
                                <p className="text-lg text-blue-600 font-semibold">{role.title}</p>
                            </div>
                            <button onClick={onCancel} className="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
                                <X size={24} />
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto">
                            <h3 className="text-md font-semibold text-gray-700 mb-2">Required Competencies</h3>
                            <p className="text-sm text-gray-500 mb-4">Select the core competencies required for a successor to excel in this role.</p>
                            <div className="bg-gray-50 p-4 rounded-lg h-80 overflow-y-auto">
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                    {allCompetencies.map(c => (
                                        <label key={c} className="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-100 cursor-pointer">
                                            <input 
                                                type="checkbox"
                                                checked={selectedCompetencies.includes(c)}
                                                onChange={() => handleToggleCompetency(c)}
                                                className="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                            />
                                            <span className="text-sm text-gray-700">{c}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>
                        </div>
                            <div className="p-4 bg-gray-50 border-t mt-auto flex justify-end space-x-3">
                                <button onClick={onCancel} className="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 font-semibold">Cancel</button>
                                <button onClick={handleSave} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold">Save Changes</button>
                            </div>
                    </div>
                </div>
            )

        }

        // --- Add Role Modal ---
        const AddRoleModal = ({ onSave, onCancel }) => {
            const [title, setTitle] = useState('');
            const [incumbent, setIncumbent] = useState('');

            const handleSave = () => {
                if (!title || !incumbent) {
                    // A more user-friendly error state would be ideal
                    console.error("Title and incumbent are required");
                    return;
                }
                onSave({ title, incumbent });
            }

            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg flex flex-col">
                        <div className="p-6 border-b">
                            <h2 className="text-2xl font-bold text-gray-800">Add New Key Role</h2>
                            <p className="text-sm text-gray-500">Define a new critical role for succession planning.</p>
                        </div>
                        <div className="p-6 space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Role Title</label>
                                    <input 
                                        type="text" 
                                        value={title}
                                        onChange={(e) => setTitle(e.target.value)}
                                        placeholder="e.g., Chief Technology Officer" 
                                        className="w-full bg-white border border-gray-300 rounded-md shadow-sm p-2 text-left focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Current Incumbent</label>
                                    <input 
                                        type="text"
                                        value={incumbent}
                                        onChange={(e) => setIncumbent(e.target.value)}
                                        placeholder="e.g., John Doe" 
                                        className="w-full bg-white border border-gray-300 rounded-md shadow-sm p-2 text-left focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                        </div>
                        <div className="p-4 bg-gray-50 border-t mt-auto flex justify-end space-x-3">
                            <button onClick={onCancel} className="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 font-semibold">Cancel</button>
                            <button onClick={handleSave} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold">Add Role</button>
                        </div>
                    </div>
                </div>
            );
        };


        // --- SUCCESSION PLANNING COMPONENT ---
        const SuccessionWorkbench = ({ onSelectTalent }) => {
            const [activeView, setActiveView] = useState('pipeline'); // 'pipeline' or 'grid'
            const [roles, setRoles] = useState(keyRolesData);
            const [selectedRole, setSelectedRole] = useState(roles[0]);
            const [poolSearchTerm, setPoolSearchTerm] = useState('');
            const [viewingTalent, setViewingTalent] = useState(null);
            const [comparisonList, setComparisonList] = useState([]);
            const [isComparisonModalOpen, setIsComparisonModalOpen] = useState(false);
            const [editingRole, setEditingRole] = useState(null);
            const [isAddRoleModalOpen, setIsAddRoleModalOpen] = useState(false);

            const handleSaveRole = (updatedRole) => {
                const newRoles = roles.map(r => r.id === updatedRole.id ? updatedRole : r);
                setRoles(newRoles);
                if(selectedRole.id === updatedRole.id) {
                    setSelectedRole(updatedRole);
                }
                setEditingRole(null);
            }

            const handleAddNewRole = ({ title, incumbent }) => {
                const newRole = {
                    id: roles.length + 1,
                    title,
                    incumbent,
                    candidates: [],
                    competencies: []
                };
                setRoles([...roles, newRole]);
                setIsAddRoleModalOpen(false);
            };

            const handleComparisonSelect = (talentId) => {
                setComparisonList(prev => 
                    prev.includes(talentId) 
                        ? prev.filter(id => id !== talentId)
                        : [...prev, talentId]
                );
            };

            const addCandidateToRole = (talentId) => {
                const roleToUpdate = roles.find(r => r.id === selectedRole.id);
                if (!roleToUpdate.candidates.includes(talentId)) {
                    const updatedRole = { ...roleToUpdate, candidates: [...roleToUpdate.candidates, talentId] };
                    const newRoles = roles.map(r => r.id === selectedRole.id ? updatedRole : r);
                    setRoles(newRoles);
                    setSelectedRole(updatedRole); 
                }
            };
            
            const removeCandidateFromRole = (talentId) => {
                const roleToUpdate = roles.find(r => r.id === selectedRole.id);
                const updatedCandidates = roleToUpdate.candidates.filter(id => id !== talentId);
                const updatedRole = { ...roleToUpdate, candidates: updatedCandidates };
                const newRoles = roles.map(r => r.id === selectedRole.id ? updatedRole : r);
                setRoles(newRoles);
                setSelectedRole(updatedRole);
            };
            
            const highPotentials = useMemo(() =>
                mockTalent.filter(t => t.status === 'Active' && t.potential >= 4 && t.name.toLowerCase().includes(poolSearchTerm.toLowerCase())),
                [poolSearchTerm]
            );

            const getReadinessInfo = (readiness) => {
                if (readiness === 'Ready Now') return { text: 'Ready Now', color: 'green' };
                if (readiness === 'Developing (1-2 Yrs)') return { text: 'Developing', color: 'blue' };
                if (readiness === 'Future Potential (3+ Yrs)') return { text: 'Future', color: 'yellow' };
                return { text: 'N/A', color: 'gray' };
            };
            
            const renderActiveView = () => {
                switch (activeView) {
                    case 'grid':
                        return <NineBoxGrid talentData={mockTalent.filter(t => t.status === 'Active')} onSelectTalent={(talent) => setViewingTalent(talent)} targetRole={selectedRole}/>;
                    case 'pipeline':
                    default:
                            return (
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 h-full">
                                    <div className="lg:col-span-1 flex flex-col bg-white p-6 rounded-xl shadow-md">
                                        <h3 className="text-xl font-semibold text-gray-800 mb-4 pb-4 border-b">Key Roles</h3>
                                        <div className="space-y-3 overflow-y-auto pr-2 flex-1">
                                            {roles.map(role => {
                                                const candidates = role.candidates.map(id => mockTalent.find(t => t.id === id));
                                                const readinessCounts = {
                                                    'Ready Now': candidates.filter(c => c && c.readiness === 'Ready Now').length,
                                                    'Developing (1-2 Yrs)': candidates.filter(c => c && c.readiness === 'Developing (1-2 Yrs)').length,
                                                    'Future Potential (3+ Yrs)': candidates.filter(c => c && c.readiness === 'Future Potential (3+ Yrs)').length,
                                                };

                                                let status = { text: 'At Risk', color: 'red' };
                                                if (readinessCounts['Ready Now'] >= 2) {
                                                    status = { text: 'Healthy', color: 'green' };
                                                } else if (readinessCounts['Ready Now'] === 1) {
                                                    status = { text: 'Monitoring', color: 'yellow' };
                                                }
                                                const statusColors = {
                                                    green: 'bg-green-100 text-green-800 border-green-500',
                                                    yellow: 'bg-yellow-100 text-yellow-800 border-yellow-500',
                                                    red: 'bg-red-100 text-red-800 border-red-500',
                                                }

                                                return (
                                                    <div key={role.id} onClick={() => setSelectedRole(role)} className={`p-4 rounded-lg cursor-pointer border-l-4 transition-all group relative ${selectedRole.id === role.id ? 'bg-blue-50 shadow-sm border-blue-500' : 'bg-gray-50/70 border-gray-200 hover:bg-gray-100 hover:border-gray-400'}`}>
                                                        <button onClick={(e) => { e.stopPropagation(); setEditingRole(role); }} className="absolute top-2 right-2 p-1.5 rounded-full bg-white/50 group-hover:bg-gray-200 text-gray-500 hover:text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity">
                                                            <Edit size={14} />
                                                        </button>
                                                        <div className="flex justify-between items-start">
                                                            <div>
                                                                <h4 className="font-bold text-gray-800 pr-6">{role.title}</h4>
                                                                <p className="text-sm text-gray-500">Incumbent: {role.incumbent}</p>
                                                            </div>
                                                            <span className={`px-2 py-0.5 text-xs font-bold rounded-full ${statusColors[status.color]}`}>{status.text}</span>
                                                        </div>
                                                        <div className="mt-3 space-y-2">
                                                            <div className="flex items-center justify-between text-xs"><span className="text-gray-600">Ready Now</span><span className="font-bold text-green-600">{readinessCounts['Ready Now']}</span></div>
                                                            <div className="flex items-center justify-between text-xs"><span className="text-gray-600">Developing</span><span className="font-bold text-blue-600">{readinessCounts['Developing (1-2 Yrs)']}</span></div>
                                                            <div className="flex items-center justify-between text-xs"><span className="text-gray-600">Future</span><span className="font-bold text-yellow-600">{readinessCounts['Future Potential (3+ Yrs)']}</span></div>
                                                        </div>
                                                    </div>
                                                )
                                            })}
                                        </div>
                                        <div className="mt-4 pt-4 border-t">
                                            <button onClick={() => setIsAddRoleModalOpen(true)} className="w-full flex items-center justify-center bg-blue-100 text-blue-700 hover:bg-blue-200 font-semibold px-4 py-2 rounded-lg text-sm">
                                                <Plus size={16} className="mr-2" /> Add New Key Role
                                            </button>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-2 flex flex-col gap-6">
                                        <div className="bg-white p-6 rounded-xl shadow-md flex-1">
                                            <div className="flex justify-between items-center pb-4 border-b">
                                                <div>
                                                    <h3 className="text-xl font-semibold text-gray-800 mb-1">Succession Pipeline: <span className="text-blue-600">{selectedRole.title}</span></h3>
                                                    <p className="text-gray-500">Manage the readiness and development of potential successors for this role.</p>
                                                </div>
                                                <button onClick={() => setIsComparisonModalOpen(true)} disabled={comparisonList.length < 2} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center font-semibold">
                                                    <Users size={16} className="mr-2" /> Compare ({comparisonList.length})
                                                </button>
                                            </div>
                                            <div className="py-4">
                                                <h4 className="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2">Required Competencies</h4>
                                                <div className="flex flex-wrap gap-2">
                                                    {selectedRole.competencies.map(c => <span key={c} className="bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1 rounded-full">{c}</span>)}
                                                </div>
                                            </div>
                                            <div className="space-y-4 pt-4 border-t">
                                                {selectedRole.candidates.length > 0 ? selectedRole.candidates.map(candidateId => {
                                                    const talent = mockTalent.find(t => t.id === candidateId);
                                                    const readiness = getReadinessInfo(talent.readiness);
                                                    const readinessColor = { green: 'bg-green-100 text-green-800', blue: 'bg-blue-100 text-blue-800', yellow: 'bg-yellow-100 text-yellow-800', gray: 'bg-gray-100 text-gray-800'};
                                                    
                                                    return (
                                                        <div key={talent.id} className="p-3 rounded-lg border bg-white hover:bg-gray-50/50 transition-colors">
                                                            <div className="flex items-center justify-between">
                                                                <div className="flex items-center space-x-4">
                                                                    <input type="checkbox" checked={comparisonList.includes(talent.id)} onChange={() => handleComparisonSelect(talent.id)} className="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 flex-shrink-0" />
                                                                    <img src={talent.headshot} className="w-12 h-12 rounded-full" alt={talent.name} />
                                                                    <div>
                                                                        <p className="font-bold text-gray-800">{talent.name}</p>
                                                                        <p className="text-sm text-gray-500">{talent.title}</p>
                                                                    </div>
                                                                </div>
                                                                <div className="flex items-center space-x-4">
                                                                    <div className="text-center"><p className="font-bold text-blue-600">{talent.performance.toFixed(1)}</p><p className="text-xs text-gray-400">Perf.</p></div>
                                                                    <div className="text-center"><p className="font-bold text-green-600">{talent.potential.toFixed(1)}</p><p className="text-xs text-gray-400">Pot.</p></div>
                                                                    <span className={`px-3 py-1 text-xs font-semibold rounded-full ${readinessColor[readiness.color]}`}>{readiness.text}</span>
                                                                    <button onClick={() => setViewingTalent(talent)} className="text-gray-400 hover:text-blue-500 p-1 rounded-full hover:bg-blue-100 transition-colors"><Eye size={18} /></button>
                                                                    <button onClick={() => removeCandidateFromRole(talent.id)} className="text-gray-400 hover:text-red-500 p-1 rounded-full hover:bg-red-100 transition-colors"><UserX size={18} /></button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )
                                                }) : (
                                                    <div className="text-center py-10 border-2 border-dashed rounded-lg"><h4 className="text-lg font-semibold text-gray-600">No Candidates Shortlisted</h4><p className="text-gray-400 mt-1">Add talent from the pool below to build the pipeline.</p></div>
                                                )}
                                            </div>
                                        </div>
                                        <div className="bg-white p-6 rounded-xl shadow-md flex-1">
                                            <h4 className="font-bold text-gray-700 mb-2">Candidate Pool (High Potentials)</h4>
                                            <div className="relative mb-4"><Search size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" /><input type="text" placeholder="Search high potentials..." value={poolSearchTerm} onChange={(e) => setPoolSearchTerm(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded-md pl-10 pr-4 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500"/></div>
                                            <div className="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                                                {highPotentials.map(talent => {
                                                    const readiness = getReadinessInfo(talent.readiness);
                                                    const readinessColor = { green: 'bg-green-100 text-green-800', blue: 'bg-blue-100 text-blue-800', yellow: 'bg-yellow-100 text-yellow-800', gray: 'bg-gray-100 text-gray-800'};
                                                    return (
                                                    <div key={talent.id} className="flex items-center justify-between p-3 rounded-lg border bg-white hover:bg-gray-50/50 transition-colors">
                                                        <div className="flex items-center space-x-4"><img src={talent.headshot} className="w-12 h-12 rounded-full" alt={talent.name} /><div><p className="font-bold text-gray-800">{talent.name}</p><p className="text-sm text-gray-500">{talent.title}</p></div></div>
                                                        <div className="flex items-center space-x-4">
                                                            <div className="text-center"><p className="font-bold text-blue-600">{talent.performance.toFixed(1)}</p><p className="text-xs text-gray-400">Perf.</p></div>
                                                            <div className="text-center"><p className="font-bold text-green-600">{talent.potential.toFixed(1)}</p><p className="text-xs text-gray-400">Pot.</p></div>
                                                            <span className={`px-3 py-1 text-xs font-semibold rounded-full ${readinessColor[readiness.color]}`}>{readiness.text}</span>
                                                            <button onClick={() => setViewingTalent(talent)} className="text-gray-400 hover:text-blue-500 p-1 rounded-full hover:bg-blue-100 transition-colors"><Eye size={18} /></button>
                                                            <button onClick={() => addCandidateToRole(talent.id)} disabled={selectedRole.candidates.includes(talent.id)} className="text-gray-400 hover:text-green-500 p-1 rounded-full hover:bg-green-100 disabled:text-gray-300 disabled:cursor-not-allowed transition-colors"><UserPlus size={18}/></button>
                                                        </div>
                                                    </div>
                                                    )
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );
                }
            }


            return(
                <>
                    {viewingTalent && (
                        <TalentProfileModal 
                            talent={viewingTalent} 
                            onClose={() => setViewingTalent(null)} 
                            onViewFullProfile={onSelectTalent}
                            targetRole={selectedRole}
                        />
                    )}
                    {isComparisonModalOpen && (
                        <CandidateComparisonModal
                            candidateIds={comparisonList}
                            allTalent={mockTalent}
                            onClose={() => setIsComparisonModalOpen(false)}
                            targetRole={selectedRole}
                        />
                    )}
                    {editingRole && (
                        <RoleProfileModal 
                            role={editingRole}
                            allCompetencies={masterCompetencies}
                            onSave={handleSaveRole}
                            onCancel={() => setEditingRole(null)}
                        />
                    )}
                    {isAddRoleModalOpen && (
                        <AddRoleModal 
                            onSave={handleAddNewRole}
                            onCancel={() => setIsAddRoleModalOpen(false)}
                        />
                    )}
                    <div className="p-8">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-2xl font-semibold text-gray-800">Succession Tools</h3>
                                <div className="bg-gray-200 p-1 rounded-lg flex items-center">
                                    <button onClick={() => setActiveView('pipeline')} className={`px-4 py-1.5 text-sm font-semibold rounded-md flex items-center transition-colors ${activeView === 'pipeline' ? 'bg-white text-blue-600 shadow' : 'text-gray-600 hover:bg-gray-300'}`}><List size={16} className="mr-2"/> Pipeline View</button>
                                    <button onClick={() => setActiveView('grid')} className={`px-4 py-1.5 text-sm font-semibold rounded-md flex items-center transition-colors ${activeView === 'grid' ? 'bg-white text-blue-600 shadow' : 'text-gray-600 hover:bg-gray-300'}`}><Grid size={16} className="mr-2"/> Talent Grid</button>
                                </div>
                            </div>

                            {renderActiveView()}
                    </div>
                </>
            );
        };


        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [currentPage, setCurrentPage] = useState('Dashboard');
            const [selectedTalentId, setSelectedTalentId] = useState(null);
            const [talentData, setTalentData] = useState(mockTalent);

            const handleUpdateTalent = (updatedTalent) => {
                setTalentData(prevData => prevData.map(t => t.id === updatedTalent.id ? updatedTalent : t));
            };

            const handleSelectTalent = (id) => {
                setSelectedTalentId(id);
                setCurrentPage('ProfilePage');
            };

            const handleBackToDirectory = () => {
                setSelectedTalentId(null);
                setCurrentPage('Talent Directory');
            };

            const renderPage = () => {
                if (currentPage === 'ProfilePage' && selectedTalentId) {
                    const talent = talentData.find(t => t.id === selectedTalentId);
                    return <ProfilePage talent={talent} onBack={handleBackToDirectory} onUpdateTalent={handleUpdateTalent}/>;
                }
                switch (currentPage) {
                    case 'Dashboard': return <Dashboard onSelectTalent={handleSelectTalent}/>;
                    case 'Talent Directory': return <TalentDirectory onSelectTalent={handleSelectTalent} />;
                    case 'Succession Planning': return <SuccessionWorkbench onSelectTalent={handleSelectTalent} />;
                    default: return <Dashboard onSelectTalent={handleSelectTalent}/>;
                }
            };

            return (
                <div className="flex bg-gray-100 font-sans min-h-screen">
                    <Sidebar currentPage={currentPage} setCurrentPage={setCurrentPage} />
                    <main className="flex-1 flex flex-col ml-64">
                        <Header title={currentPage === 'ProfilePage' ? "Talent Directory" : currentPage} />
                        <div className="flex-1 overflow-y-auto">
                            {renderPage()}
                        </div>
                    </main>
                </div>
            );
        }

        // --- RENDER THE APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );
    </script>
</body>
</html>


